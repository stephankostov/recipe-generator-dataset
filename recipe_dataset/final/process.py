# AUTOGENERATED! DO NOT EDIT! File to edit: ../../notebooks/10-final-db-process.ipynb.

# %% auto 0
__all__ = ['root', 'special_tokens', 'shift_food_ids', 'process_food_ids', 'compile_recipe_food_ids']

# %% ../../notebooks/10-final-db-process.ipynb 3
from pyprojroot import here
root = here()
import sys
sys.path.append(str(root))

# %% ../../notebooks/10-final-db-process.ipynb 4
import pandas as pd
import numpy as np

from tqdm import tqdm
tqdm.pandas()

# %% ../../notebooks/10-final-db-process.ipynb 6
special_tokens = ['pad', 'mask', 'unknown']

# %% ../../notebooks/10-final-db-process.ipynb 17
def shift_food_ids(food_ids, special_tokens):
    shift = len(special_tokens)
    return food_ids.progress_apply(lambda id: id + shift if pd.notna(id) else id)

# %% ../../notebooks/10-final-db-process.ipynb 21
def process_food_ids(food_ids, special_tokens):
    food_ids['food_id'] = shift_food_ids(food_ids['food_id'], special_tokens)
    food_ids = food_ids.fillna(special_tokens.index('unknown'))
    return food_ids

# %% ../../notebooks/10-final-db-process.ipynb 27
def compile_recipe_food_ids(food_ids, special_tokens):

    recipe_food_ids = pd.DataFrame(food_ids.groupby('recipe')['food_id'].aggregate(list).tolist()).loc[:,:14]

    recipe_food_ids = recipe_food_ids \
        .fillna(special_tokens.index('pad')) \
        .astype('int') \
        .to_numpy()

    return recipe_food_ids
