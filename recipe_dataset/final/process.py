# AUTOGENERATED! DO NOT EDIT! File to edit: ../../notebooks/10-final-db-process.ipynb.

# %% auto 0
__all__ = ['root', 'special_tokens', 'temp_remap', 'shift_food_ids', 'process_food_ids', 'merge_duplicates']

# %% ../../notebooks/10-final-db-process.ipynb 3
from pyprojroot import here
root = here()
import sys
sys.path.append(str(root))

# %% ../../notebooks/10-final-db-process.ipynb 4
import pandas as pd
import numpy as np

from tqdm import tqdm
tqdm.pandas()

from ..utils.parallel import parallel_apply


# %% ../../notebooks/10-final-db-process.ipynb 6
special_tokens = ['pad', 'mask', 'unknown', 'end']

# %% ../../notebooks/10-final-db-process.ipynb 13
temp_remap = {
    143: 142,
    150: 149,
    262: 261,
    1064: 1063
}

# %% ../../notebooks/10-final-db-process.ipynb 48
def shift_food_ids(food_ids, special_tokens):
    shift = len(special_tokens)
    return food_ids.progress_apply(lambda id: id + shift if pd.notna(id) else id)

# %% ../../notebooks/10-final-db-process.ipynb 53
def process_food_ids(food_ids, special_tokens):
    food_ids = shift_food_ids(food_ids, special_tokens)
    # food_ids = food_ids.replace(temp_remap)
    food_ids = food_ids.fillna(special_tokens.index('unknown'))
    return food_ids

# %% ../../notebooks/10-final-db-process.ipynb 57
def merge_duplicates(recipe):
    group = recipe.groupby('food_id')['weight_ratio'].sum()
    return group
