# AUTOGENERATED! DO NOT EDIT! File to edit: ../../notebooks/utils/full-run-utils.ipynb.

# %% auto 0
__all__ = ['select_last_file', 'load_or_create_dataframe']

# %% ../../notebooks/utils/full-run-utils.ipynb 1
import pandas as pd

from pathlib import Path

# %% ../../notebooks/utils/full-run-utils.ipynb 2
def select_last_file(file_path, glob_pattern=r'*[0-9]*.feather'):
    file_path = Path(file_path)
    files = file_path.glob(glob_pattern)
    files = sorted(list(files))
    return files[-1]

def load_or_create_dataframe(save_path, create_function, is_series=False, series_name=None, dtype_backend='pyarrow', postprocess_cbs=[], **kargs):

    if Path(save_path).exists():
        df = pd.read_feather(save_path, dtype_backend=dtype_backend)
        if is_series: 
            df = df.iloc[:,0]
            if series_name: df = df.rename(series_name)
    else:
        df = create_function(**kargs)
        if postprocess_cbs: 
            for cb in postprocess_cbs:
                df = cb(df)
        if is_series: 
            if series_name: df = df.rename(series_name)
            df.to_frame().to_feather(save_path)
        else: df.to_feather(save_path)

    return df
